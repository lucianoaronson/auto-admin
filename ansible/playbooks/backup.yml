- hosts: linux
  become: true
  vars_files:
    - ../group_vars/all.yml

  tasks:
    - name: Asegurar permisos ejecutables de scripts
      ansible.builtin.file:
        path: "{{ repo_root }}/linux/backup/backup_dirs.sh"
        mode: "0755"

    - name: Ejecutar backup
      ansible.builtin.command: bash -lc "{{ repo_root }}/linux/backup/backup_dirs.sh"
      args: { chdir: "{{ repo_root }}" }
      register: backup_out
      changed_when: "'[DONE]' in backup_out.stdout or backup_out.rc == 0"

    - name: Mostrar salida
      ansible.builtin.debug: { var: backup_out.stdout }
